# Home Assistant Configuration Example
# Add this to your configuration.yaml after installing the add-on

# REST Sensor - Simple next bin
sensor:
  - platform: rest
    name: "Next Bin"
    resource: "http://local-north-herts-bins:8000/api/sensor/next?uprn=010070035296"
    value_template: "{{ value_json.state }}"
    json_attributes:
      - days
      - date
    scan_interval: 3600

# Template sensors for easier use in automations
template:
  - sensor:
      - name: "Bin Collection Days"
        unique_id: bin_collection_days
        state: "{{ state_attr('sensor.next_bin', 'days') }}"
        unit_of_measurement: "days"
        icon: >-
          {% set days = state_attr('sensor.next_bin', 'days') | int(-1) %}
          {% if days == 0 %}mdi:alert-circle
          {% elif days == 1 %}mdi:alert
          {% else %}mdi:calendar-clock{% endif %}

  - binary_sensor:
      - name: "Bin Day Tomorrow"
        unique_id: bin_day_tomorrow
        state: "{{ state_attr('sensor.next_bin', 'days') == 1 }}"

# Automation - Evening reminder
automation:
  - id: bin_reminder_evening
    alias: "Bin Reminder - Evening"
    trigger:
      - platform: time
        at: "18:00:00"
    condition:
      - condition: template
        value_template: "{{ state_attr('sensor.next_bin', 'days') == 1 }}"
    action:
      - service: notify.notify
        data:
          title: "Bin Collection Tomorrow"
          message: "Put out your {{ states('sensor.next_bin') }}"
